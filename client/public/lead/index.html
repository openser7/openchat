<!doctype html>
<html lang="es">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">

    <title>Get OpenSer</title>
</head>

<body>
    <div class="container">
        <form class="needs-validation" novalidate>
            <div class="form-row">
                <div class="form-group col-md-12">
                    <label for="inputNombre">Nombre </label>
                    <input type="text" class="form-control" id="inputNombre" placeholder="Nombre Completo" required>
                    <div class="invalid-tooltip">
                        El nombre es requerido.
                    </div>
                </div>
                <div class="form-group col-md-6">
                    <label for="inputEmail">Email </label>
                    <input type="email" class="form-control" id="inputEmail" placeholder="Email" type="email" required>
                    <div class="invalid-tooltip">
                        Email incorrecto.
                    </div>
                </div>
                <div class="form-group col-md-6">
                    <label for="inputTelefono">Teléfono </label>
                    <input type="Telefono" class="form-control" id="inputTelefono" placeholder="Teléfono" type="tel" required>
                    <div class="invalid-tooltip">
                            Teléfono incorrecto.
                        </div>
                </div>
            </div>
            <div class="form-group">
                <label for="inputEmpresa">Empresa </label>
                <input type="text" class="form-control" id="inputEmpresa" placeholder="Open Service" required>
            </div>
            <div class="form-group" id="textAreaDiv" sytle="display:none">
                <label for="textAreaMensaje">Mensaje </label>
                <textarea class="form-control" id="textAreaMensaje" rows="3"></textarea>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="selectNumEmpleados">Número de Empleados </label>
                    <select class="form-control" id="selectNumEmpleados" required>
                        <option>-</option>
                        <option>Menor a 50</option>
                        <option>De 50 a 200</option>
                        <option>De 200 a 500</option>
                        <option>Mayor a 500</option>
                    </select>
                </div>
                <div class="form-group col-md-6">
                    <label for="selectOrigen">¿Cómo nos encontraste?</label>
                    <select id="selectOrigen" class="form-control" required>
                        <option>-</option>
                        <option>Google</option>
                        <option>Facebook</option>
                        <option>Blog</option>
                        <option>Email</option>
                        <option>Revista</option>
                        <option>Otro</option>
                    </select>
                    <div class="invalid-tooltip">
                        Selecciona una opción.
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="checkTermCond" required>
                    <label class="form-check-label" for="gridCheck">
                        Acepto los
                        <a href="https://www.openser.com/aviso-de-privacidad/" target="_blank">términos y condiciones</a> de uso.
                    </label>
                    <div class="invalid-feedback">
                        Es necesario aceptar los terminos y condiciones.
                    </div>
                </div>
            </div>
            <input type="button" id="send" class="btn btn-primary" value="Enviar">
        </form>
    </div>


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
    <script>
        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : sParameterName[1];
                }
            }
        };
        function validatePhone(phoneNumber) {
            var phoneNumberPattern = /^\(?(\d{3})\)?[- ]?(\d{3})[- ]?(\d{4})$/;
            return phoneNumberPattern.test(phoneNumber);
        }
        function validarTelefono(){
            if(validatePhone($('#inputTelefono').val()) == false ){
                    $('#inputTelefono').addClass('is-invalid');
                   return false;
                } else {
                    $('#inputTelefono').removeClass('is-invalid');
                   return true;
                }
        }
        //GET Params for dynamic form 
        var landing = getUrlParameter('landing');//Parametro
        var mensaje = getUrlParameter('mensaje');//Parametro
        var buttonColor = getUrlParameter('buttoncolor');//Parametro
        var formcolor = getUrlParameter('formcolor');//Parametro
        var redirect = getUrlParameter('redirect');//Parametro
        var color = getUrlParameter('redirect');//Parametro

        if (landing == null) {
            alert('Se requiere el parametro landing');
        }

        if (redirect == null) {
            alert('Se requiere el parametro redirect');
        }

        if (mensaje == 's' || mensaje == "S") {
            $('#textAreaDiv').show();
        } else {
            $('#textAreaDiv').hide();
        }

        //STYLE 
        if (buttonColor) {
            $('input#send').css('border-color', buttonColor);
            $('input#send').css('background-color', buttonColor); $('input#send').css('border-color', buttonColor)
        }
        if (formcolor) {
            $('body').css('background', formcolor)
        }

        $('#send').click(function () {
            $('form')[0].classList.add('was-validated');
            

            if ($('form')[0].checkValidity() === true && validarTelefono() == true) {
                if ($('#checkTermCond')[0].checked) {
                    $.ajax({
                        method: "POST",
                        url: "https://empresarial.openser.com/lead/save",
                        data: {
                            "nombre": $('#inputNombre').val(),
                            "empresa": $('#inputEmpresa').val(),
                            "descripcion": $('#textAreaMensaje').val(),
                            "email": $('#inputEmail').val(),
                            "telefono": $('#inputTelefono').val(),
                            "numempleado": $('#selectNumEmpleados').val(),
                            "origen": $('#selectOrigen').val(),
                            "landing": landing //Enviar de cual landing es 
                        },
                        beforeSend: function (xhr) {
                            xhr.overrideMimeType("text/plain; charset=x-user-defined");
                        },
                    }).done(function (data) {
                        if (data == "true") {
                            $('textarea').val('');
                            $('form')[0].classList.remove('was-validated');
                            $('input').val('');
                            $('#send').val('Enviar');
                            // similar behavior as an HTTP redirect
                            window.location.replace(redirect == null ? "https://www.openser.com/gracias/#wpcf7-f700-p1814-o1" : redirect);
                        } else {
                            alert('Error al guarda solicitud');
                        }
                        if (console && console.log) {
                            console.log("Service guardado con exito", data);
                        }
                    }).fail(function (err) {
                        console.log(err.responseText);
                        alert('Ocurrio un error:' + err.responseText);
                    });
                }


            }
        });


    </script>
</body>

</html>