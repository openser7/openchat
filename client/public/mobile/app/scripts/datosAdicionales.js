function addRelatedData(a,d){if(!d.addNew){if(d.container){_$(d.container).removeAll()}else{if(d.$container){d.$container.removeAll()}}}var b=new Array();Ext.each(a.Lista,function(k,j){if(typeof k==="undefined"){return}if(!(typeof k.DatoAdicional==="undefined")){k=k.DatoAdicional}var i={xtype:"",id:null,name:null,edition:d.edition,emptyText:"",Sequencia:k.Sequencia};var h="datoadicional-"+k.IdDatoAdicional;if(!k.IdDatoAdicional){h="datoadicional-"+(Math.random()*100000).toFixed(0)}while(_$(h)!=null){h="datoadicional-"+(Math.random()*100000).toFixed(0)}i.id=i.name=h;i.dbId=i.IdDatoAdicional=k.IdDatoAdicional;i.fieldLabel=k.Nombre;i.label=k.Nombre;i.labelAlign="top";var g=k.EmptyText!=null?k.EmptyText:k.Nombre;i.emptyText=g;i.requerido=false;if(k.Requerido){i.allowBlank=false;i.label=i.fieldLabel+'<span class="labelRequiered"> * </span>';i.requerido=true}if(d.noFieldLabel){i.fieldLabel="";datoadicional.label=""}if(k.Cls!=null){i.cls=k.Cls}if(typeof i.cls==="undefined"){i.cls="cmpDropped additionalField"}else{i.cls+=" cmpDropped additionalField"}if(k.IndexInsert!=null){i.IndexInsert=k.IndexInsert}i.IdTipoDato=k.IdTipoDato;i.readOnly=k.SoloLectura;switch(k.IdTipoDato){case ID_TipoDato.Entero:i.xtype="numberfield";i.allowDecimals=false;if(!validarNulo(k.ValorMax)&&k.ValorMax!=0){i.minValue=k.ValorMin;i.maxValue=k.ValorMax}if(k.Value!=null){i.value=k.Value}break;case ID_TipoDato.String:i.xtype="textfield";if(k.ValorMax){i.maxLength=parseInt(k.ValorMax)}if(k.Value){i.value=k.Value}i.width="100%";break;case ID_TipoDato.Boleano:i.xtype="switch";i.allowBlank=true;if(k.Value!=null){if(k.Value=="SI"||k.Value=="true"){k.Value=true}if(k.Value=="NO"||k.Value=="false"){k.Value=false}i["default"]=k.Value}break;case ID_TipoDato.Calendario:i.xtype="datefield";if(k.Value!=null){i.value=k.Value}break;case ID_TipoDato.Combo:i.xtype="combobox";i.displayField="Descripcion";i.valueField="Descripcion";i.store=new Ext.data.Store({fields:["IdOpcion","Descripcion"],idProperty:"IdOpcion",data:k.Opcion});i.forceSelection=true;if(k.Value){i.value=k.Value}break;case ID_TipoDato.Decimales:i.xtype="numberfield";i.minValue=k.minValue!=null?k.minValue:k.ValorMin;i.maxValue=k.maxValue!=null?k.maxValue:k.ValorMax;if(i.minValue==null){delete (i.minValue)}else{i.minValue=+i.minValue}if(i.maxValue==null){delete (i.maxValue)}else{i.maxValue=+i.maxValue}if(k.Value){i.value=k.Value}break;case ID_TipoDato.Hora:i.xtype="timefield";if(k.Value){i.value=k.Value}break;case ID_TipoDato.Porcentaje:i.xtype="jSlider";break;case ID_TipoDato.OpcionMultiple:i.xtype="formpanel";i.cls="checkgroup";if(k.Requerido){i.title=k.Nombre+'<span class="labelRequiered"> * </span>'}else{i.title=k.Nombre}i.margin="0 0 10 0";var f=Array();i.columns=1;Ext.each(k.Opcion,function(m){if(m.Valor==1){m.Valor=true}if(m.Valor==0){m.Valor=false}var l={xtype:"checkboxfield",margin:"0 10 -5 20",label:m.Descripcion,name:m.Descripcion,inputValue:m.Descripcion,readOnly:k.SoloLectura,value:m.Valor,checked:m.Valor};f.push(l)});i.items=f;break}i.width=k.Width!=null?k.Width:"100%";i.anchor="95%";b.push(i)});if(b.length){if(_$(d.headerContainer)){_$(d.headerContainer).show()}d.$container?d.$container.show():_$(d.container).show()}else{if(_$(d.headerContainer)){_$(d.headerContainer).hide()}if(_$(d.container)){_$(d.container).hide()}}d.container=d.$container?d.$container:d.container;b.sort(function(g,f){return parseFloat(g.Sequencia)-parseFloat(f.Sequencia)});agregarElementos(b,d.container);var c=d.$container?d.$container:_$(d.container);if(c.el){var e=c.el.up(".popup");if(e){setTimeout(function(){e.component.onResize()},0)}}}function getParamsRelatedData(a){var d=a;if(typeof a=="string"){d=_$(a)}var c=d.items.items,b=[];Ext.each(c,function(k,f){var j={IdDatoAdicional:"",Valor:""};switch(k.xtype){case"formpanel":if(k.getCls().indexOf("checkgroup")!=-1){var h="";for(var g=k.items.items.length-1;g>=0;g--){var e=k.items.items[g];if(e.xtype&&e.xtype==="checkboxfield"&&e.getChecked()){if(g===0){h=h+e.getName()+"|"}else{h=h+e.getName()+"|"}}}if(h.length==2){h=h.replace(/\|/g,"")}j.IdDatoAdicional=k.dbId;j.Valor=h.toString()}break;case"datefield":j.IdDatoAdicional=k.dbId;j.Valor=k.getRawValue()==null?"":k.getRawValue().toString();break;case"timefield":j.IdDatoAdicional=k.dbId;j.Valor=k.getRawValue()==null?"":k.getRawValue().toString();break;default:j.IdDatoAdicional=k.dbId;j.Valor=k.getValue()==null?"":k.getValue().toString();break}if(j.IdDatoAdicional!=""){b.push(j)}});return b}function validarDatosAdicionales(c){var b=true;var d=c;if(typeof c=="string"){d=_$(c)}var a=d.items.items;Ext.Array.each(a,function(h,f){if(h.getCls().indexOf("checkgroup")!=-1){var e=null;h.items.items.forEach(function(i){if(i.xtype&&i.xtype=="checkboxfield"&&i.getChecked()){e=true}});h.value=e}var g=(typeof h.getValue==="function")?h.getValue():h.value;if(h.allowBlank==false&&(g===null||g===""||g==="undefined")){b=false;return}});if(!b){return function(){alert(lang.required_fields_validation)}}return getParamsRelatedData(c)}function agregarElementos(a,b){var c;if(typeof b=="object"){c=b}else{c=_$(b)}if(c){Ext.each(a,function(d){if(d.IndexInsert!=null){if(d.edition){c.items.items[d.IndexInsert].destroy()}c.insert(d.IndexInsert,d)}else{c.add(d)}});c.updateLayout()}if(b==="datosAdicionales"){_$("incident_register").updateLayout()}};